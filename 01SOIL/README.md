# Lora Soil Moisture Sensor V3

```c++
/*
Version:		V5.0
Author:			UNKOWN
Create Date:	UNKOWN
Note:
	2022/4/2	V5.3: Move to Malora porject
	2021/12/15	V5.2: Fix RadioHead demo can't setModemConfig. 
	2021/11/17  V5.1: Fix code bug,example "ESP32 Receiver" pin define wrong.
	2021/10/22	V5.0: Modify the document structure. 
	2021/9/26	V4.0: The new hardware removed the 555 chip, updated the BOM, and significantly improved battery life.
	2021/8/24	V3.1: Now can read ADC value without 555.
	2021/7/22	V3.0: Now support Lorawan to TTN.
	2020/10/26	v2.2: Add a power-save verson.Using watch dog and sleep mode.
	2020/8/24	v2.1: Add pcb file.
    2020/7/24	v2.0: Rebuid readme,add pic. By Vincent
*/
```

[toc]

# Makerfabs

[Makerfabs home page](https://www.makerfabs.com/)

[Makerfabs Wiki](https://makerfabs.com/wiki/index.php?title=Main_Page)


# Introduce

The Lora soil moisture sensor is based on Atmel's Atmega328P, it collects local air temperature/ humidity with sensor AHT10, and detect the soil humidity with capacitor-humility measurement solution with MCU clock, and transmit the local environment data to the gateway, with Lora communication, suit for applications for smart-farm, irrigation, agriculture, etc. 

In applications, always you do not need to check the air/soil state continuously, have a test of them for few seconds after then minutes/hours sleeping is normally Ok for most projects. To save power, there the Air/ Soil measuring functional could be shut down in the working, so they can be only powered ON a short time and then a long time power off. With MCU in sleeping mode and low power consumption Lora module, this module works ok with 2 AAA battery more than one year. Besides, this sensor is coated with waterproof paint, which makes it longer working time in damp soil. 

Product Link: [Lora_Soil_Moisture_Sensor](https://www.makerfabs.com/lora-soil-moisture-sensor.html)

Wiki Link:  [Lora_Soil_Moisture_Sensor_V3](https://www.makerfabs.com/wiki/index.php?title=Lora_Soil_Moisture_Sensor_V3)

## Feature

- Classic ATMEL AVR 8-bit Atmega328P, with Arduino Pro Mini(3.3V/8M bootloader pre-loaded) .
- Capacitor-humility measurement.
- AHT10 temperature and humidity sensor.
- Working with 2 AAA more than one years.
- 3D printed case.
- Waterproof coating.
- Unique ID, can be used directly without secondary programming.


### Front
![front](md_pic/front.jpg)


### Hardware Update

We removed the 555 chip and made a lot of changes to the code. The current soil moisture test uses MCU clock pulses instead of those generated by the 555 chip. Sleep mode has also been optimized more.

Detailed power consumption data is being edited....



# Command

## Lora Node Massage

```c
Type ID: 01
Short name: SOIL
```

## Action

SOIL does not have the receiving function, unlike other Lora Nodes. 
It is powered by AAA batteries and actively sends data every 75 minutes or so to ensure service time. 
Does not provide the 114 query function provided by the common Lora Nodes. 

If you want to change the time, you can change it:

```c++
//Set sleep time, when value is 1 almost sleep 20s,when value is 450, almost 1 hour.
//Each sleep cycle almost 8s.
#define SLEEP_CYCLE 1

```



## Reply

The code contains a unique ID and sends Lora messages every 75 minutes in the following format:

```c++
ID01XXXX[space]REPLY[space]:[space]SOIL[space][Soil Status]
    
ID010123 REPLY : SOIL INEDX:0 H:48.85 T:30.50 ADC:896 BAT:1016

/*
String message = 
    "INEDX:" + (String)packetnum + " H:" + (String)humidity + 
    " T:" + (String)temperature + " ADC:" + (String)sensorValue + 
    " BAT:" + (String)batValue;

String back_str = node_id + " REPLY : SOIL " + message;
*/
```


The degree of soil ADC is about 900 in air (completely dry) and 600 in water (completely wet).

